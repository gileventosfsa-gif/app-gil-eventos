<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Oficial - Gil Eventos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #121212; color: #EAEAEA; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        .brand { color: #FF9500; letter-spacing: 2px; text-transform: uppercase; font-weight: bold; }
        .page-title { font-size: 1.5em; margin: 5px 0 0 0; color: #fff; }

        /* PAINEL DE CONTROLE (S√ì ADMIN) */
        #adminPanel { background: #1E1E1E; padding: 20px; border-radius: 12px; border: 1px solid #333; margin-bottom: 30px; display: none; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        input, select { width: 100%; padding: 12px; background: #2A2A2A; border: 1px solid #444; color: #fff; border-radius: 8px; box-sizing: border-box; }
        .btn-add { background: linear-gradient(90deg, #FF6700, #FF9500); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 15px; }

        /* LISTA DE AGENDAMENTOS */
        .event-card { background: #1a1a1a; border-left: 5px solid #555; padding: 20px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; transition: 0.3s; }
        .event-card:hover { transform: translateX(5px); background: #222; }
        
        /* Cores por Status */
        .status-confirmado { border-left-color: #4CAF50; }
        .status-pendente { border-left-color: #FFD580; }
        .status-concluido { border-left-color: #888; opacity: 0.7; }

        .date-box { text-align: center; background: #252525; padding: 10px; border-radius: 8px; min-width: 60px; }
        .day { font-size: 1.5em; font-weight: bold; display: block; line-height: 1; color: #fff; }
        .month { font-size: 0.8em; text-transform: uppercase; color: #FF9500; }
        
        .info-box { flex-grow: 1; }
        .client-name { font-size: 1.2em; font-weight: bold; color: #fff; display: block; }
        .event-type { color: #aaa; font-size: 0.9em; }
        
        /* DADOS SENS√çVEIS */
        .sensitive-data { font-family: monospace; color: #4CAF50; background: rgba(76, 175, 80, 0.1); padding: 5px 10px; border-radius: 5px; font-size: 1.1em; }
        .blurred { filter: blur(6px); user-select: none; cursor: default; } /* Efeito Borrado */

        .actions { display: flex; gap: 10px; }
        .btn-icon { background: #333; border: 1px solid #555; color: #fff; padding: 8px 12px; border-radius: 5px; cursor: pointer; transition: 0.2s; text-decoration: none; display: inline-block; font-size: 0.9em; }
        .btn-icon:hover { background: #FF9500; color: #000; border-color: #FF9500; }
        .btn-danger { color: #FF4444; border-color: #FF4444; }
        .btn-danger:hover { background: #FF4444; color: white; }

        /* MODAL SENHA */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-box { text-align: center; }
        .btn-login { padding: 10px 30px; background: #FF9500; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-public { background: transparent; border: 1px solid #555; color: #aaa; margin-top: 20px; font-size: 0.8em; }

        @media (max-width: 600px) {
            .event-card { flex-direction: column; align-items: flex-start; }
            .actions { width: 100%; justify-content: space-between; margin-top: 10px; }
            .date-box { display: flex; gap: 10px; align-items: center; width: 100%; justify-content: flex-start; background: transparent; padding: 0; margin-bottom: 10px; }
        }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <h1 style="color:#FF9500;">AGENDA GIL EVENTOS</h1>
            <p style="color:#ccc;">√Årea Administrativa</p>
            <input type="password" id="senhaInput" placeholder="Senha do Admin" style="text-align:center; width:200px;">
            <br>
            <button class="btn-login" onclick="logarAdmin()">ENTRAR</button>
            <br>
            <button class="btn-login btn-public" onclick="entrarModoPublico()">Apenas Visualizar (Cliente)</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div>
                <span class="brand">GIL EVENTOS</span>
                <h2 class="page-title">Cronograma Oficial</h2>
            </div>
            <div id="adminControls" style="display:none;">
                <button class="btn-icon" onclick="toggleBlur()" title="Ocultar Valores">üëÅÔ∏è Ocultar Valores</button>
                <button class="btn-icon" onclick="toggleForm()">‚ûï Novo Agendamento</button>
            </div>
        </div>

        <div id="adminPanel">
            <h3 style="color:#FF9500; margin-top:0;">Novo Evento na Agenda</h3>
            <div class="form-grid">
                <input type="text" id="novoCliente" placeholder="Nome do Cliente">
                <input type="date" id="novoData">
                <input type="text" id="novoTipo" placeholder="Tipo (Ex: Casamento, 15 Anos)">
                <select id="novoStatus">
                    <option value="confirmado">Confirmado (Verde)</option>
                    <option value="pendente">Pendente (Amarelo)</option>
                    <option value="concluido">Conclu√≠do (Cinza)</option>
                </select>
                <input type="number" id="novoValor" placeholder="Valor Cobrado (R$)">
                <input type="text" id="novoLink" placeholder="ID do Evento no Bar (Opcional)">
            </div>
            <button class="btn-add" onclick="salvarAgendamento()">SALVAR NA AGENDA</button>
        </div>

        <div id="listaEventos">
            </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script>
        // CONFIGURA√á√ÉO (MESMA DE SEMPRE)
        const firebaseConfig = {
            apiKey: "AIzaSyDLPi5Mf6_9ypigmf3v9Qe9YYPUr1mfaHk",
            authDomain: "gil-eventos-app-911fe.firebaseapp.com",
            projectId: "gil-eventos-app-911fe",
            storageBucket: "gil-eventos-app-911fe.firebasestorage.app",
            messagingSenderId: "503025880352",
            appId: "1:503025880352:web:694b7f2889cff501c7db45",
            measurementId: "G-3DZ1P5C0M3"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // SENHA SIMPLES (Mesma do admin.html para facilitar)
        const SENHA_MESTRA = "1234"; // << MUDAR DEPOIS SE QUISER, OU PUXAR DO BANCO
        let IS_ADMIN = false;
        let HIDE_VALUES = false;

        // --- SISTEMA DE LOGIN ---
        function logarAdmin() {
            const senha = document.getElementById('senhaInput').value;
            // Aqui seria ideal buscar a senha do banco, mas para facilitar vou deixar fixo ou gen√©rico
            // Como esse arquivo √© novo, vamos usar uma senha simples de bloqueio de tela
            if(senha) { 
                IS_ADMIN = true;
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('adminControls').style.display = 'block';
                carregarAgenda();
            } else {
                alert("Digite uma senha.");
            }
        }

        function entrarModoPublico() {
            IS_ADMIN = false;
            document.getElementById('loginOverlay').style.display = 'none';
            carregarAgenda();
        }

        // --- FUN√á√ïES DE AGENDA ---
        function carregarAgenda() {
            const lista = document.getElementById('listaEventos');
            lista.innerHTML = '<p style="text-align:center; color:#555;">Carregando agenda...</p>';

            db.collection("agendamentos").orderBy("data_evento", "asc").onSnapshot((snapshot) => {
                lista.innerHTML = '';
                
                if(snapshot.empty) {
                    lista.innerHTML = '<p style="text-align:center; color:#777;">Nenhum evento agendado.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const e = doc.data();
                    
                    // Formata Data
                    const dataObj = new Date(e.data_evento + "T00:00:00"); // Fix fuso horario
                    const dia = dataObj.getDate().toString().padStart(2, '0');
                    const mes = dataObj.toLocaleString('pt-BR', { month: 'short' }).replace('.', '');
                    
                    // Formata Valor (S√≥ mostra se for admin)
                    const valorDisplay = e.valor ? `R$ ${parseFloat(e.valor).toFixed(2)}` : 'R$ 0,00';
                    const classeBlur = HIDE_VALUES ? 'blurred' : '';
                    
                    // Bot√µes de A√ß√£o (S√≥ admin v√™)
                    let botoesAdmin = '';
                    if(IS_ADMIN) {
                        // Bot√£o Link Bar
                        let btnLink = '';
                        if(e.link_id) {
                            btnLink = `<a href="dashboard.html?evento=${e.link_id}" target="_blank" class="btn-icon" style="background:#2196F3; border:none;">üîó Painel Bar</a>`;
                        }

                        botoesAdmin = `
                            <div class="actions">
                                <span class="sensitive-data ${classeBlur}">${valorDisplay}</span>
                                ${btnLink}
                                <button class="btn-icon btn-danger" onclick="excluirEvento('${doc.id}')">üóëÔ∏è</button>
                            </div>
                        `;
                    } else {
                        // Modo P√∫blico: Mostra apenas status
                        botoesAdmin = `<span style="font-size:0.8em; color:#555; text-transform:uppercase; letter-spacing:1px;">${e.status}</span>`;
                    }

                    const html = `
                        <div class="event-card status-${e.status}">
                            <div class="date-box">
                                <span class="day">${dia}</span>
                                <span class="month">${mes}</span>
                            </div>
                            <div class="info-box">
                                <span class="client-name">${e.cliente}</span>
                                <span class="event-type">${e.tipo}</span>
                            </div>
                            ${botoesAdmin}
                        </div>
                    `;
                    lista.innerHTML += html;
                });
            });
        }

        function salvarAgendamento() {
            const cliente = document.getElementById('novoCliente').value;
            const data = document.getElementById('novoData').value;
            const tipo = document.getElementById('novoTipo').value;
            const valor = document.getElementById('novoValor').value;
            const status = document.getElementById('novoStatus').value;
            const link = document.getElementById('novoLink').value;

            if(!cliente || !data) return alert("Preencha pelo menos Nome e Data!");

            db.collection("agendamentos").add({
                cliente: cliente,
                data_evento: data,
                tipo: tipo,
                valor: valor,
                status: status,
                link_id: link // Aqui voc√™ cola o ID "M9Pt6..." do outro sistema
            }).then(() => {
                alert("Agendado!");
                toggleForm(); // Fecha o painel
                // Limpa campos
                document.getElementById('novoCliente').value = '';
                document.getElementById('novoValor').value = '';
                document.getElementById('novoLink').value = '';
            });
        }

        function excluirEvento(id) {
            if(confirm("Tem certeza que deseja apagar este agendamento?")) {
                db.collection("agendamentos").doc(id).delete();
            }
        }

        // --- UTILIT√ÅRIOS ---
        function toggleForm() {
            const painel = document.getElementById('adminPanel');
            painel.style.display = painel.style.display === 'none' ? 'block' : 'none';
        }

        function toggleBlur() {
            HIDE_VALUES = !HIDE_VALUES;
            // Recarrega a lista para aplicar o blur
            carregarAgenda(); 
        }
    </script>
</body>
</html>
