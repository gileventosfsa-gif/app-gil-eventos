<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Gil Eventos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #121212; color: #EAEAEA; margin: 0; padding: 20px; padding-bottom: 80px; }
        .container { max-width: 800px; margin: auto; }
        
        h2 { color: #FF9500; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 30px; font-size: 1.2em; text-transform: uppercase; }
        
        /* FORMUL√ÅRIOS */
        .input-3d, .select-3d, .textarea-3d {
            padding: 12px; border-radius: 10px; border: 1px solid #333;
            background: #1E1E1E; color: #fff; width: 100%; font-size: 1em;
            margin-bottom: 10px; box-sizing: border-box; font-family: 'Poppins', sans-serif;
        }
        .textarea-3d { min-height: 120px; resize: vertical; white-space: pre-wrap; }

        /* BOT√ïES */
        .btn-action { width: 100%; padding: 15px; font-weight: bold; border-radius: 10px; border: none; cursor: pointer; margin-top: 5px; font-size: 1em; transition: 0.2s; }
        .btn-save { background: linear-gradient(90deg, #FF9500, #FF6F00); color: #000; }
        .btn-import { background: #333; color: #FF9500; border: 1px solid #FF9500; margin-bottom: 15px; }
        .btn-close { background: #444; color: #aaa; margin-top: 10px; }
        .btn-action:active { transform: scale(0.98); }

        /* LISTAS DE EVENTOS */
        .event-list-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 15px; background: #222; margin-bottom: 10px; border-radius: 10px; 
            border-left: 5px solid #777; 
        }
        .event-list-item.confirmed { border-left-color: #00E676; background: rgba(0, 230, 118, 0.05); }
        .event-list-item.pending { border-left-color: #FF9500; }
        .event-list-item.past { border-left-color: #555; opacity: 0.6; }
        
        .btn-icon { width: 35px; height: 35px; border-radius: 50%; border: none; cursor: pointer; margin-left: 5px; display: flex; align-items: center; justify-content: center; font-size: 1.1em; }
        .btn-check { background: #00E676; color: #000; }
        .btn-edit { background: #2196F3; color: #fff; }
        .btn-trash { background: #F44336; color: #fff; }

        /* ABAS */
        .admin-tabs { display: flex; gap: 5px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 10px; background: #222; border: none; color: #777; cursor: pointer; font-weight: bold; border-radius: 8px 8px 0 0; }
        .tab-btn.active { background: #FF9500; color: #000; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* MODAIS */
        #loginOverlay, #editModalOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #editModalOverlay { display: none; } 
        
        .modal-box { background: #1E1E1E; padding: 25px; border-radius: 20px; width: 90%; max-width: 500px; border: 1px solid #333; max-height: 90vh; overflow-y: auto; }
        .modal-label { display: block; text-align: left; color: #aaa; margin: 10px 0 5px 0; font-size: 0.9em; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <h2 style="color:#FF9500; margin-top:0; border:none;">ACESSO RESTRITO</h2>
        <input type="password" id="senhaInput" class="input-3d" style="max-width:200px; text-align:center;" placeholder="Senha">
        <button type="button" class="btn-action btn-save" style="max-width:200px;" onclick="logar()">ENTRAR</button>
    </div>

    <div id="editModalOverlay">
        <div class="modal-box">
            <h3 style="color:#FF9500; margin-top:0;">üìù Editar Evento</h3>
            <input type="hidden" id="editId">
            
            <span class="modal-label">Cliente:</span>
            <input type="text" id="editCliente" class="input-3d">
            
            <div style="display:flex; gap:10px;">
                <div style="flex:1"><span class="modal-label">Data:</span><input type="date" id="editData" class="input-3d"></div>
                <div style="flex:1"><span class="modal-label">Hora:</span><input type="time" id="editHora" class="input-3d"></div>
            </div>

            <span class="modal-label">Detalhes / Materiais:</span>
            <textarea id="editDetalhes" class="textarea-3d"></textarea>

            <button type="button" class="btn-action btn-save" onclick="salvarEdicao()">üíæ SALVAR ALTERA√á√ïES</button>
            <button type="button" class="btn-action btn-close" onclick="fecharEdicao()">CANCELAR</button>
        </div>
    </div>

    <div class="container" id="painelPrincipal" style="display:none;">
        
        <h1 style="text-align:center; color:#FF9500;">PAINEL DE GEST√ÉO</h1>

        <h2>‚ûï Novo Agendamento</h2>
        <div style="background:#1a1a1a; padding:15px; border-radius:10px; border:1px solid #333;">
            <input type="text" id="admCliente" class="input-3d" placeholder="Nome do Cliente / Evento">
            
            <div style="display:flex; gap:10px;">
                <input type="date" id="admData" class="input-3d">
                <input type="time" id="admHora" class="input-3d">
            </div>

            <div style="display:flex; gap:10px;">
                <select id="admTipoMenu" class="select-3d">
                    <option value="classico">ü•É Menu Cl√°ssico</option>
                    <option value="premium">üëë Menu Premium</option>
                    <option value="misto">üåü Misto (Cl√°ssico + Premium)</option>
                </select>
                
                <select id="admTamanhoLista" class="select-3d">
                    <option value="reduzida">Reduzida (<30)</option>
                    <option value="30-35">30 a 35 pessoas</option>
                    <option value="40-60">40 a 60 pessoas</option>
                    <option value="70-100">70 a 100 pessoas</option>
                    <option value="150-200">150 a 200 pessoas</option>
                    <option value="250-300">250 a 300 pessoas</option>
                </select>
            </div>

            <button type="button" class="btn-action btn-import" onclick="importarLista()">üì• Importar Lista Autom√°tica</button>
            <textarea id="admDetalhes" class="textarea-3d" placeholder="A lista de materiais aparecer√° aqui..."></textarea>
            
            <button type="button" class="btn-action btn-save" onclick="salvarEvento()">üíæ CADASTRAR EVENTO</button>
        </div>

        <h2>üìÖ Agenda de Eventos</h2>
        <div class="admin-tabs">
            <button type="button" class="tab-btn active" onclick="mudarAba('pendentes')">‚è≥ PENDENTES</button>
            <button type="button" class="tab-btn" onclick="mudarAba('confirmados')">‚úÖ CONFIRMADOS</button>
            <button type="button" class="tab-btn" onclick="mudarAba('concluidos')">üèÅ CONCLU√çDOS</button>
        </div>

        <div id="tabPendentes" class="tab-content active"></div>
        <div id="tabConfirmados" class="tab-content"></div>
        <div id="tabConcluidos" class="tab-content"></div>

        <h2>üõ† Ferramentas</h2>
        <div style="display:flex; gap:10px;">
            <button type="button" class="btn-action btn-import" onclick="gerarHistorico()">üé≤ Gerar Hist√≥rico</button>
            <button type="button" class="btn-action btn-import" onclick="gerarFeriados()">üìÖ Importar Feriados</button>
        </div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyDLPi5Mf6_9ypigmf3v9Qe9YYPUr1mfaHk", authDomain: "gil-eventos-app-911fe.firebaseapp.com", projectId: "gil-eventos-app-911fe", storageBucket: "gil-eventos-app-911fe.firebasestorage.app", messagingSenderId: "503025880352", appId: "1:503025880352:web:694b7f2889cff501c7db45" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const SENHA_MESTRA = "9859";
        let eventsCache = [];

        // BANCO DE DADOS DAS LISTAS (COMPLETO)
        const LISTAS = {
            'classico': {
                'reduzida': `*Lista Reduzida (<30) - Cl√°ssico*\nüìç03 abacaxis\nüìç10 tangerinas\nüìç10 lim√µes taiti\nüìç10 kiwi\nüìç07 maracuj√°s\nüìç02 pct morango\nüìç02 cx uva\nüìç01L acerola\nüìç20kg Gelo\nüìç1-2L Vodka\nüìç1-2L Aguardente`,
                '30-35': `*Lista 30-35 - Cl√°ssico*\nüìç04 abacaxis\nüìç15 tangerinas\nüìç15 lim√µes taiti\nüìç15 kiwi\nüìç10 maracuj√°s\nüìç03 pct morango\nüìç02 cx uva\nüìç2L acerola\nüìç20kg Gelo\nüìç2-3L Vodka\nüìç2-3L Aguardente`,
                '40-60': `*Lista 40-60 - Cl√°ssico*\nüìç07 abacaxis\nüìç20 tangerinas\nüìç20 lim√µes\nüìç15 kiwi\nüìç15 maracuj√°s\nüìç04 pct morango\nüìç03 cx uva\nüìç3L acerola\nüìç30kg Gelo\nüìç3-4L Vodka\nüìç3-4L Aguardente`,
                '70-100': `*Lista 70-100 - Cl√°ssico*\nüìç10-15 abacaxis\nüìç25-35 tangerinas\nüìç30-40 lim√µes\nüìç20-30 kiwi\nüìç20-30 maracuj√°s\nüìç05-07 pct morango\nüìç05-07 cx uva\nüìç05-07L acerola\nüìç40-70kg Gelo\nüìç7-10L Vodka\nüìç5-7L Aguardente`,
                '150-200': `*Lista 150-200 - Cl√°ssico*\nüìç15-20 abacaxis\nüìç30-45 tangerinas\nüìç35-50 lim√µes\nüìç30-45 kiwi\nüìç30-40 maracuj√°s\nüìç10-15 pct morango\nüìç07-10 cx uva\nüìç10-15L acerola\nüìç50-70kg Gelo\nüìç10-15L Vodka\nüìç7-10L Aguardente`,
                '250-300': `*Lista 250-300 - Cl√°ssico*\nüìç20-25 abacaxis\nüìç35-50 tangerinas\nüìç40-55 lim√µes\nüìç35-50 kiwi\nüìç35-50 maracuj√°s\nüìç15-20 pct morango\nüìç10-15 cx uva\nüìç15-20L acerola\nüìç60-70kg Gelo\nüìç15-17L Vodka\nüìç10-15L Aguardente`
            },
            'premium': {
                'reduzida': `*Lista Reduzida (<30) - PREMIUM*\nüìç8 Laranjas\nüìç3 Abacaxis\nüìç4 Lim√µes Siciliano\nüìç10 Lim√µes Taiti\nüìç20kg Gelo CUBO\nüìç1L Gin\nüìç1L Aperol\nüìç1L Rum\nüìç2L √Ågua G√°s\nüìç2L T√¥nica\nüìçHortel√£, Alecrim`,
                '30-35': `*Lista 30-35 - PREMIUM*\nüìç10 Laranjas\nüìç4 Abacaxis\nüìç5 Lim√µes Siciliano\nüìç15 Lim√µes Taiti\nüìç30kg Gelo CUBO\nüìç2L Gin\nüìç2L Aperol\nüìç2L Rum\nüìç3L √Ågua G√°s\nüìç3L T√¥nica`,
                '40-60': `*Lista 40-60 - PREMIUM*\nüìç15 Laranjas\nüìç7 Abacaxis\nüìç12 Lim√µes Siciliano\nüìç30 Lim√µes Taiti\nüìç50kg Gelo CUBO\nüìç5L Gin\nüìç5L Aperol\nüìç5L Rum\nüìç5L √Ågua G√°s\nüìç5L T√¥nica`,
                '70-100': `*Lista 70-100 - PREMIUM*\nüìç15-18 Laranjas\nüìç7-10 Abacaxis\nüìç12-15 Lim√µes Siciliano\nüìç30-35 Lim√µes Taiti\nüìç60kg Gelo CUBO\nüìç7L Gin\nüìç7L Aperol\nüìç7L Rum\nüìç7L √Ågua G√°s\nüìç7L T√¥nica`,
                '150-200': `*Lista 150-200 - PREMIUM*\nüìç18-25 Laranjas\nüìç10-13 Abacaxis\nüìç15-20 Lim√µes Siciliano\nüìç35-40 Lim√µes Taiti\nüìç70kg Gelo CUBO\nüìç8L Gin\nüìç8L Aperol\nüìç8L Rum\nüìç10L √Ågua G√°s\nüìç10L T√¥nica`,
                '250-300': `*Lista 250-300 - PREMIUM*\nüìç25-30 Laranjas\nüìç13-15 Abacaxis\nüìç20-30 Lim√µes Siciliano\nüìç40-50 Lim√µes Taiti\nüìç80kg Gelo CUBO\nüìç10L Gin\nüìç10L Aperol\nüìç10L Rum\nüìç12L √Ågua G√°s\nüìç12L T√¥nica`
            },
            'misto': {
                'reduzida': `*Lista Reduzida (<30) - MISTO*\nüìç05 abacaxis\nüìç10 tangerinas\nüìç15 taiti\nüìç10 kiwi\nüìç07 maracuj√°s\nüìç8 Laranjas\nüìç4 Siciliano\nüìç10kg Gelo Escama\nüìç10kg Gelo Cubo\nüìç1-2L Vodka\nüìç1-2L Aguardente\nüìç1L Gin\nüìç1L Aperol\nüìç1L Rum`,
                '30-35': `*Lista 30-35 - MISTO*\nüìç06 abacaxis\nüìç15 tangerinas\nüìç20 taiti\nüìç15 kiwi\nüìç10 maracuj√°s\nüìç10 Laranjas\nüìç5 Siciliano\nüìç15kg Gelo Escama\nüìç15kg Gelo Cubo\nüìç2-3L Vodka\nüìç2-3L Aguardente\nüìç2L Gin\nüìç2L Aperol\nüìç2L Rum`,
                '40-60': `*Lista 40-60 - MISTO*\nüìç10 abacaxis\nüìç20 tangerinas\nüìç35 taiti\nüìç15 kiwi\nüìç15 maracuj√°s\nüìç15 Laranjas\nüìç12 Siciliano\nüìç20kg Gelo Escama\nüìç30kg Gelo Cubo\nüìç3-4L Vodka\nüìç3-4L Aguardente\nüìç3L Gin\nüìç3L Aperol\nüìç3L Rum`,
                '70-100': `*Lista 70-100 - MISTO*\nüìç12-15 abacaxis\nüìç25-35 tangerinas\nüìç35-50 taiti\nüìç20-30 kiwi\nüìç20-30 maracuj√°s\nüìç15-18 Laranjas\nüìç12-15 Siciliano\nüìç30-50kg Gelo Escama\nüìç30kg Gelo Cubo\nüìç7L Vodka\nüìç5L Aguardente\nüìç5L Gin\nüìç5L Aperol\nüìç5L Rum`,
                '150-200': `*Lista 150-200 - MISTO*\nüìç20-25 abacaxis\nüìç30-45 tangerinas\nüìç50-70 taiti\nüìç30-45 kiwi\nüìç30-40 maracuj√°s\nüìç18-25 Laranjas\nüìç5-20 Siciliano\nüìç30-50kg Gelo Escama\nüìç30kg Gelo Cubo\nüìç10L Vodka\nüìç7L Aguardente\nüìç5L Gin\nüìç5L Aperol\nüìç5L Rum`,
                '250-300': `*Lista 250-300 - MISTO*\nüìç30-45 abacaxis\nüìç35-50 tangerinas\nüìç50-80 taiti\nüìç35-50 kiwi\nüìç35-50 maracuj√°s\nüìç25-30 Laranjas\nüìç20-30 Siciliano\nüìç50-60kg Gelo Escama\nüìç30kg Gelo Cubo\nüìç15L Vodka\nüìç10L Aguardente\nüìç8L Gin\nüìç8L Aperol\nüìç8L Rum`
            }
        };

        function logar() {
            if(document.getElementById('senhaInput').value === SENHA_MESTRA) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('painelPrincipal').style.display = 'block';
                carregarEventos();
            } else alert("Senha incorreta");
        }

        function importarLista() {
            const tipo = document.getElementById('admTipoMenu').value;
            const tamanho = document.getElementById('admTamanhoLista').value;
            
            if(LISTAS[tipo] && LISTAS[tipo][tamanho]) {
                document.getElementById('admDetalhes').value = LISTAS[tipo][tamanho];
            } else {
                alert("Lista n√£o encontrada para essa combina√ß√£o.");
            }
        }

        function salvarEvento() {
            const cliente = document.getElementById('admCliente').value;
            const data = document.getElementById('admData').value;
            const hora = document.getElementById('admHora').value;
            const detalhes = document.getElementById('admDetalhes').value;
            const tipo = document.getElementById('admTipoMenu').value;

            if(!cliente || !data) return alert("Preencha Nome e Data!");

            db.collection("agendamentos").add({
                cliente, data_evento: data, hora_inicio: hora, 
                detalhes, tipo_pacote: tipo, status: 'pendente'
            }).then(() => {
                alert("Evento Salvo!");
                document.getElementById('admCliente').value = "";
                document.getElementById('admData').value = "";
                document.getElementById('admHora').value = "";
                document.getElementById('admDetalhes').value = "";
            });
        }

        function carregarEventos() {
            db.collection("agendamentos").orderBy("data_evento").onSnapshot(snapshot => {
                const pendentes = document.getElementById('tabPendentes');
                const confirmados = document.getElementById('tabConfirmados');
                const concluidos = document.getElementById('tabConcluidos');
                
                pendentes.innerHTML = ""; confirmados.innerHTML = ""; concluidos.innerHTML = "";
                eventsCache = [];
                const hoje = new Date().toISOString().split('T')[0];

                snapshot.forEach(doc => {
                    const e = doc.data();
                    const id = doc.id;
                    eventsCache.push({id, ...e}); // Salva no cache para edi√ß√£o
                    
                    const dataDisplay = e.data_evento.split('-').reverse().join('/');
                    const isPast = e.data_evento < hoje;

                    let html = `
                        <div class="event-list-item ${isPast ? 'past' : e.status}">
                            <div style="flex-grow:1;">
                                <strong style="color:${isPast ? '#777' : '#FF9500'}">${dataDisplay}</strong> - ${e.cliente}<br>
                                <span style="font-size:0.8em; color:#aaa;">${e.tipo_pacote ? e.tipo_pacote.toUpperCase() : 'PERSONALIZADO'}</span>
                            </div>
                            <div style="display:flex;">
                                ${!isPast && e.status !== 'confirmado' ? `<button type="button" onclick="mudarStatus('${id}','confirmado')" class="btn-icon btn-check">‚úÖ</button>` : ''}
                                <button type="button" onclick="abrirEdicao('${id}')" class="btn-icon btn-edit">üìÑ</button>
                                <button type="button" onclick="deletarEvento('${id}')" class="btn-icon btn-trash">‚úñ</button>
                            </div>
                        </div>`;

                    if (isPast) concluidos.innerHTML += html;
                    else if (e.status === 'confirmado') confirmados.innerHTML += html;
                    else pendentes.innerHTML += html;
                });
            });
        }

        function mudarAba(aba) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if(aba === 'pendentes') { document.querySelectorAll('.tab-btn')[0].classList.add('active'); document.getElementById('tabPendentes').classList.add('active'); }
            if(aba === 'confirmados') { document.querySelectorAll('.tab-btn')[1].classList.add('active'); document.getElementById('tabConfirmados').classList.add('active'); }
            if(aba === 'concluidos') { document.querySelectorAll('.tab-btn')[2].classList.add('active'); document.getElementById('tabConcluidos').classList.add('active'); }
        }

        // --- FUN√á√ïES DE EDI√á√ÉO ---
        function abrirEdicao(id) {
            const ev = eventsCache.find(e => e.id === id);
            if(!ev) return;

            document.getElementById('editId').value = ev.id;
            document.getElementById('editCliente').value = ev.cliente;
            document.getElementById('editData').value = ev.data_evento;
            document.getElementById('editHora').value = ev.hora_inicio || '';
            document.getElementById('editDetalhes').value = ev.detalhes || '';

            document.getElementById('editModalOverlay').style.display = 'flex';
        }

        function salvarEdicao() {
            const id = document.getElementById('editId').value;
            const dados = {
                cliente: document.getElementById('editCliente').value,
                data_evento: document.getElementById('editData').value,
                hora_inicio: document.getElementById('editHora').value,
                detalhes: document.getElementById('editDetalhes').value
            };
            db.collection("agendamentos").doc(id).update(dados).then(() => {
                alert("Atualizado!");
                fecharEdicao();
            });
        }

        function fecharEdicao() { document.getElementById('editModalOverlay').style.display = 'none'; }
        function mudarStatus(id, s) { db.collection("agendamentos").doc(id).update({status: s}); }
        function deletarEvento(id) { if(confirm("Deletar?")) db.collection("agendamentos").doc(id).delete(); }
        function gerarHistorico() { if(confirm("Gerar?")) for(let i=0;i<3;i++) db.collection("agendamentos").add({cliente:"Teste", data_evento:"2024-01-01", status:'confirmado'}); }
        function gerarFeriados() { if(confirm("Add Natal?")) db.collection("agendamentos").add({cliente:"Natal", data_evento:"2025-12-25", status:'confirmado'}); }
    </script>
</body>
</html>
